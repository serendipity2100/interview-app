import axios, { AxiosError, AxiosRequestConfig, AxiosResponse, InternalAxiosRequestConfig } from '@ohos/axios'
import { iLoginUserModel } from '../../models/AccountModel';

export const instance = axios.create({
  baseURL: 'https://api-harmony-teach.itheima.net/'
})


export function request<T = null, D = null>(config: AxiosRequestConfig<D>) {
  return instance<null, AxiosResponse<T, null>, D>(config)
}


// æ‹¦æˆªå™¨:
// æœ¬è´¨: é’©å­å‡½æ•° - è‡ªåŠ¨æ‰§è¡Œ
// æ—¶æœº: è¯·æ±‚æ‹¦æˆªå™¨ - è¯·æ±‚å‰æ‰§è¡Œ

// 1. æ‹¦æˆªå™¨é…ç½®åœ¨å®žä¾‹å¯¹è±¡ä¸Š
instance.interceptors.request.use((config: InternalAxiosRequestConfig) => {

  // ðŸ’¥æ¯æ¬¡å‘è¯·æ±‚å‰, è‡ªåŠ¨åœ¨è¿™é‡Œæ·»åŠ tokenåˆ°è¯·æ±‚å¤´ä¸Š
  // 2. å…ˆèŽ·å–token
  const user = AppStorage.get('user') as iLoginUserModel

  // 3. åˆ¤æ–­useræ˜¯ä¸æ˜¯undefined
  if (user !== undefined) {
    // 4. æ·»åŠ tokenåˆ°è¯·æ±‚å¤´ä¸Š
    // 5. åˆ é™¤æ‰€æœ‰æŽ¥å£ä¸­ä¼ å‚çš„token, æµ‹è¯•æŽ¥å£æ­£å¸¸
    config.headers.Authorization = `Bearer ${user.token}`
  }

  // console.log('è¯·æ±‚å‰è§¦å‘äº†, å¯ä»¥çœ‹åˆ°è¯·æ±‚çš„å‚æ•° -----> ', JSON.stringify(config))

  return config;
}, (error: AxiosError) => {
  return Promise.reject(error);
});


